#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

# clone hiduino
echo "-----> Copying HIDUINO files"
BUILD_DIR=$1
cd $BUILD_DIR/vendor
git clone https://github.com/ddiakopoulos/hiduino.git

# add LUFA
echo "-----> Adding LUFA"
cd $BUILD_DIR/vendor/hiduino
wget http://www.fourwalledcubicle.com/files/LUFA/LUFA-140928.zip
jar xf LUFA-140928.zip
rm LUFA-140928.zip

# intsall AVRDUDE
echo "-----> Installing AVRDUDE"
cd $BUILD_DIR/vendor
wget http://ftp.gnu.org/gnu/binutils/binutils-2.28.tar.gz
tar -zxvf binutils-2.28.tar.gz
rm binutils-2.28.tar.gz
cd $BUILD_DIR/vendor/binutils-2.28
./configure --target=avr --program-prefix="avr-"
make

cd $BUILD_DIR/vendor/
wget http://download.savannah.gnu.org/releases/avr-libc/avr-libc-2.0.0.tar.bz2
tar -xvf avr-libc-2.0.0.tar.bz2
rm avr-libc-2.0.0.tar.bz2
cd $BUILD_DIR/vendor/avr-libc-2.0.0
./configure --host=avatom r
make
